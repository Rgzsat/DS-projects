import math
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import tensorflow as tf

from tensorflow.keras.preprocessing.sequence import TimeseriesGenerator
from tensorflow.keras import backend as K
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense, LSTM
from tensorflow.keras.callbacks import TensorBoard
from tensorflow.keras.optimizers import Adam
from tensorflow.keras.models import load_model
from keras.layers import Dense, Dropout, Flatten

import skopt
from sklearn.preprocessing import MinMaxScaler
from skopt import gp_minimize, forest_minimize
from skopt.space import Real, Integer 
from skopt.plots import plot_convergence, plot_objective, plot_evaluations, plot_histogram, plot_objective_2D 
from skopt.utils import use_named_args
import keras
from tensorflow.keras.models import load_model

import seaborn as sns

bigru= keras.models.load_model("Introduce your path here")
bigru.summary()

bilstm= keras.models.load_model("Introduce your path here")
bilstm.summary()

scaler = "Introduce your path here"


def df(dataset):   
    df1= dataset.iloc[1: , :]
    cap= df1['mAh']/1000
    max_cap=cap[len(cap)-1]
    dod= (max_cap - cap)/max_cap
    df2= df1.assign(SOC= dod)
    X= scaler.fit_transform(df2)
    
    ir=(dataset['V'][0]-df2['V'])/df2['I'] 
    yi= ir[0]*df2['I']+df2['V']
    y = np.array(yi)
    y = np.reshape(y, (-1, 1))
    y= scaler.fit_transform(y)
    
    return X, y, df2

dataset_test= "Introuce your path here"
